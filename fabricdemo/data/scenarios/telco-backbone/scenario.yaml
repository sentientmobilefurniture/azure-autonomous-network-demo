# ============================================================================
# Scenario Manifest — Telco Backbone (Compound Failure)
# ============================================================================

name: telco-backbone
display_name: "APAC Telco Backbone — Submarine Cable + Power Compound Failure"
description: >
  A cyclone damages the Adelaide-Perth submarine cable while a simultaneous
  storm surge causes a power failure at DC-ADL-01. Two independent root causes
  create a compound incident: Perth is isolated with only a 10G microwave
  backup, Adelaide loses its south aggregation switch, and the combined
  cascade generates ~6,000 alerts across the backbone. Three workflow-
  specialized agents (NetworkForensics, OperationsAdvisor, CapacityAnalyst)
  collaborate under an IncidentCommander to untangle the compound failure.
version: "1.0"
domain: telecommunications

# ---------------------------------------------------------------------------
# Use cases & example questions
# ---------------------------------------------------------------------------

use_cases:
  - "Compound failure triage — separating simultaneous root causes"
  - "Submarine cable failure and microwave backup capacity assessment"
  - "Datacenter power failure blast radius analysis"
  - "Perth isolation and alternate path engineering"
  - "Cross-domain alert correlation (optical + power + routing)"
  - "Multi-tier SLA impact: PLATINUM (Defence) vs GOLD (mining/energy)"

example_questions:
  - "What are the root causes of the current compound incident?"
  - "Why is the microwave backup unable to absorb Perth-bound traffic?"
  - "Which services are affected by the DC-ADL-01 power failure?"
  - "What alternate MPLS paths exist to reach Perth from Sydney?"
  - "Which SLA policies are being breached and what are the penalty rates?"
  - "Is there a historical precedent for simultaneous cable and power failures?"
  - "What capacity does the SYD-ADL inland fibre have for Perth rerouting?"
  - "Which firewall clusters protect the affected enterprise VPNs?"

# ---------------------------------------------------------------------------
# Data layout
# ---------------------------------------------------------------------------

paths:
  entities: data/entities
  graph_schema: graph_schema.yaml
  telemetry: data/telemetry
  runbooks: data/knowledge/runbooks
  tickets: data/knowledge/tickets
  prompts: data/prompts
  default_alert: data/prompts/alert_storm.md

# ---------------------------------------------------------------------------
# Data sources
# ---------------------------------------------------------------------------

data_sources:
  graph:
    connector: "fabric-gql"
    config:
      database: "networkgraph"
      graph: "telco-backbone-topology"
      partition_key: "/partitionKey"
    schema_file: "graph_schema.yaml"

  telemetry:
    connector: "fabric-kql"
    config:
      database: "telemetry"
      container_prefix: "telco-backbone"
      containers:
        - name: AlertStream
          partition_key: /SourceNodeType
          csv_file: AlertStream.csv
          id_field: AlertId
          numeric_fields: [OpticalPowerDbm, BitErrorRate, CPUUtilPct, PacketLossPct]
        - name: LinkTelemetry
          partition_key: /LinkId
          csv_file: LinkTelemetry.csv
          id_field: null
          numeric_fields: [UtilizationPct, OpticalPowerDbm, BitErrorRate, LatencyMs]

  search_indexes:
    runbooks:
      index_name: "telco-backbone-runbooks-index"
      source: "data/knowledge/runbooks"
      blob_container: "runbooks"
    tickets:
      index_name: "telco-backbone-tickets-index"
      source: "data/knowledge/tickets"
      blob_container: "tickets"

# ---------------------------------------------------------------------------
# Agents — Unconventional workflow-organized architecture
# ---------------------------------------------------------------------------
# Instead of the standard orchestrator + 4 tool-per-agent pattern,
# this scenario uses 3 workflow-specialized agents. Each agent owns
# one investigation domain and carries the tools needed to execute
# that domain independently, reducing orchestrator round-trips.
#
#   IncidentCommander (orchestrator)
#     ├── NetworkForensicsAgent   [graph + telemetry tools]
#     ├── OperationsAdvisorAgent  [runbook search + ticket search]
#     └── CapacityAnalyst         [graph tool]
# ---------------------------------------------------------------------------

agents:
  # --- Sub-agent: Network Forensics ---
  # Combines graph exploration AND telemetry querying in a single agent
  # so it can correlate infrastructure topology with time-series anomalies
  # without requiring orchestrator mediation.
  - name: "NetworkForensicsAgent"
    role: "network_forensics"
    model: "gpt-4.1"
    instructions_file: "prompts/foundry_network_forensics_agent.md"
    tools:
      - type: "openapi"
        spec_template: "graph"
        keep_path: "/query/graph"
      - type: "openapi"
        spec_template: "telemetry"
        keep_path: "/query/telemetry"

  # --- Sub-agent: Operations Advisor ---
  # Combines runbook KB search AND historical ticket search so it can
  # cross-reference SOPs with past incident patterns in a single agent.
  - name: "OperationsAdvisorAgent"
    role: "operations_advisor"
    model: "gpt-4.1"
    instructions_file: "prompts/foundry_operations_advisor_agent.md"
    tools:
      - type: "azure_ai_search"
        index_key: "runbooks"
      - type: "azure_ai_search"
        index_key: "tickets"

  # --- Sub-agent: Capacity Analyst ---
  # Specialized in alternate path assessment, failover capacity modelling,
  # and traffic engineering. Has graph access to query topology/MPLS paths
  # but no telemetry — works with the structural model, not live data.
  - name: "CapacityAnalyst"
    role: "capacity_analyst"
    model: "gpt-4.1"
    instructions_file: "prompts/foundry_capacity_analyst.md"
    tools:
      - type: "openapi"
        spec_template: "graph"
        keep_path: "/query/graph"

  # --- Orchestrator: Incident Commander ---
  # Lightweight coordinator that delegates to the three workflow agents.
  # Focuses on (1) triaging the compound failure, (2) separating the two
  # root causes, (3) synthesising findings into a situation report.
  - name: "IncidentCommander"
    role: "orchestrator"
    model: "gpt-4.1"
    instructions_file: "prompts/foundry_incident_commander.md"
    is_orchestrator: true
    connected_agents:
      - "NetworkForensicsAgent"
      - "OperationsAdvisorAgent"
      - "CapacityAnalyst"

# ---------------------------------------------------------------------------
# Graph visualisation hints
# ---------------------------------------------------------------------------

graph_styles:
  node_types:
    DataCenter:     { color: "#059669", size: 32, icon: "building" }
    CoreRouter:     { color: "#38BDF8", size: 28, icon: "router" }
    FirewallCluster: { color: "#EF4444", size: 24, icon: "shield" }
    AggSwitch:      { color: "#FB923C", size: 22, icon: "switch" }
    BaseStation:    { color: "#A78BFA", size: 18, icon: "antenna" }
    TransportLink:  { color: "#3B82F6", size: 16, icon: "link" }
    MPLSPath:       { color: "#C084FC", size: 14, icon: "path" }
    Service:        { color: "#CA8A04", size: 20, icon: "service" }
    SLAPolicy:      { color: "#FB7185", size: 12, icon: "policy" }
    BGPSession:     { color: "#F472B6", size: 14, icon: "session" }

# ---------------------------------------------------------------------------
# Telemetry baselines
# ---------------------------------------------------------------------------

telemetry_baselines:
  link_telemetry:
    - metric: LatencyMs
      normal: "2–15 ms"
      degraded: "> 50 ms"
      down: "9999 ms"
    - metric: OpticalPowerDbm
      normal: "-8 to -12 dBm"
      degraded: "< -20 dBm"
      down: "< -30 dBm (or -42 dBm for submarine cable loss of light)"
    - metric: BitErrorRate
      normal: "< 1e-9"
      degraded: "> 1e-6"
      down: "≈ 1"
    - metric: UtilizationPct
      normal: "20–70%"
      degraded: "> 80%"
      down: "0% (with other down indicators)"
  alert_stream:
    - metric: PacketLossPct
      normal: "< 1%"
      anomalous: "> 2%"
    - metric: CPUUtilPct
      normal: "< 70%"
      anomalous: "> 85%"
    - metric: OpticalPowerDbm
      normal: "-8 to -12 dBm"
      anomalous: "< -20 dBm"
    - metric: BitErrorRate
      normal: "< 1e-9"
      anomalous: "> 1e-6"
