# v11d — Agent Bar & Resizable Panels

**Status:** Audited — ready for implementation
**Author:** Copilot
**Date:** 2026-02-16
**Depends on:** v11c (performance optimisation)

---

## Verdict: FEASIBLE

All 8 phases touch well-isolated code with no cross-cutting side-effects.
The audit uncovered 2 critical data-model issues, 4 bugs, 1 dead-code nit,
and 1 UX note — **all have straightforward fixes** that are incorporated
into this plan below. No architectural changes, no new dependencies, no
migrations. Total effort: **~3 hours**.

### Risk summary

| Risk | Mitigation |
|------|------------|
| `agent_ids.json` nested structure + missing fields (A1, A2) | Fixed in Phase 1 — both provisioner paths updated, reader handles nesting |
| `composes` CSS Modules syntax in plain CSS (A3) | Removed — dual classNames in JSX already apply shared styles |
| `onCollapse`/`onExpand` don't exist in react-resizable-panels (A5, A6) | Replaced with `onResize` + `panelRef` imperative API |
| Tab switch resets panel sizes (A8) | Mitigated with `autoSaveId` on all PanelGroups |
| No new dependencies | `react-resizable-panels@^4.6.2` already installed |

---

## Problem Statement

### Agent visibility

The header has two tiny health indicators (API dot + "N Agents ✓"). They
convey almost nothing — you can't see *which* agents exist, what tools they
have, or which is the orchestrator without navigating to the Resources tab.

**Goal:** Replace the dots with an **Agent Bar** — a slim strip beneath the
header showing each provisioned agent as a card with health dot, name, and
hover tooltip (role, model, tools, connected agents).

### Resizing

Three content boundaries should be user-resizable but aren't (or lack visual
affordance):

| Boundary | Current state |
|----------|---------------|
| Topology ↕ Investigation | Resizable, but handle is near-invisible |
| Investigation ↔ Diagnosis | Fixed 50/50 (`w-1/2`) — not draggable |
| Main content ↔ History sidebar | Fixed `w-72` — toggle only |
| Content ↕ Terminal | Resizable, but handle has no grip |

**Goal:** Make all boundaries draggable with visible grip affordances.

---

## Execution Plan

**Order:** 1 → 2 → 3 → 4 → 5 → 6 → (7) → (8) → deploy → verify

### Phase 1: Extend `/api/agents` to Return Agent Specs

**Files:** `api/app/agent_ids.py`, `scripts/agent_provisioner.py`
**Effort:** 20 min | **Risk:** Low

#### 1a. Fix `get_agent_list()` to handle nested `agent_ids.json`

The live `agent_ids.json` structure nests sub-agents:

```json
{
  "orchestrator": { "id": "asst_…", "name": "Orchestrator" },
  "sub_agents": {
    "GraphExplorerAgent": { "id": "asst_…", "name": "GraphExplorerAgent" },
    "TelemetryAgent":     { "id": "asst_…", "name": "TelemetryAgent" }
  }
}
```

The current `get_agent_list()` iterates top-level keys and checks
`"id" in val` — this **silently skips all sub-agents** because
`sub_agents` is a dict-of-dicts, not a dict with `"id"`.

**File:** `api/app/agent_ids.py` — Replace `get_agent_list()` and
`get_agent_names()`:

```python
def _make_agent_stub(role: str, entry: dict) -> dict:
    """Build a single agent stub from an agent_ids.json entry."""
    agent = {
        "id": entry["id"],
        "name": entry.get("name", role),
        "role": role,
        "model": entry.get("model", ""),
        "status": "provisioned",
    }
    if entry.get("tools"):
        agent["tools"] = entry["tools"]
    if entry.get("is_orchestrator"):
        agent["is_orchestrator"] = True
    if entry.get("connected_agents"):
        agent["connected_agents"] = entry["connected_agents"]
    return agent


def get_agent_list() -> list[dict]:
    """Return list of agent stubs for the /agents endpoint.

    Handles both flat and nested (sub_agents) structures.
    """
    data = _read_agent_ids()
    if not data:
        return []
    agents = []
    for key, val in data.items():
        if isinstance(val, dict) and "id" in val:
            # Top-level agent (e.g. "orchestrator")
            agents.append(_make_agent_stub(key, val))
        elif isinstance(val, dict):
            # Nested container (e.g. "sub_agents")
            for sub_key, sub_val in val.items():
                if isinstance(sub_val, dict) and "id" in sub_val:
                    agents.append(_make_agent_stub(sub_key, sub_val))
    return agents


def get_agent_names() -> dict[str, str]:
    """Return {agent_id: agent_name} mapping from agent_ids.json."""
    data = _read_agent_ids()
    names: dict[str, str] = {}
    for key, val in data.items():
        if isinstance(val, dict) and "id" in val:
            names[val["id"]] = val.get("name", key)
        elif isinstance(val, dict):
            for sub_key, sub_val in val.items():
                if isinstance(sub_val, dict) and "id" in sub_val:
                    names[sub_val["id"]] = sub_val.get("name", sub_key)
    return names
```

#### 1b. Persist spec fields during provisioning

Both provisioner write paths currently save only `{id, name}`. Enrich with
`model`, `tools`, `is_orchestrator`, `connected_agents`.

**File:** `scripts/agent_provisioner.py`

**Config-driven path (`provision_from_config`, ~line 490):**

```python
# Before — result dict only has id + name:
result = {
    "orchestrator": {
        "id": created_agents.get(orch_name, ""),
        "name": orch_name or "",
    },
    "sub_agents": {
        sa["name"]: {"id": sa["id"], "name": sa["name"]}
        for sa in sub_agents
    },
}

# After — include spec fields from agent_defs:
agent_def_map = {a["name"]: a for a in agent_defs}
result = {
    "orchestrator": {
        "id": created_agents.get(orch_name, ""),
        "name": orch_name or "",
        "model": agent_def_map.get(orch_name, {}).get("model", ""),
        "is_orchestrator": True,
        "tools": agent_def_map.get(orch_name, {}).get("tools", []),
        "connected_agents": agent_def_map.get(orch_name, {}).get("connected_agents", []),
    },
    "sub_agents": {
        a["name"]: {
            "id": created_agents.get(a["name"], ""),
            "name": a["name"],
            "model": a.get("model", ""),
            "is_orchestrator": False,
            "tools": a.get("tools", []),
            "connected_agents": a.get("connected_agents", []),
        }
        for a in agent_defs if not a.get("is_orchestrator")
    },
}
```

**Legacy path (`provision`, ~line 343):** Apply the same enrichment. The
sub-agent roles/tools are hardcoded in that method — add the equivalent
fields inline (e.g. `"tools": [{"type": "openapi", "spec_template": "graph"}]`
for the graph explorer).

> **Fallback:** If `agent_ids.json` doesn't have spec fields (older deploy),
> the frontend shows just name + model — no crash.

---

### Phase 2: Create `AgentBar` + `AgentCard` Components

**Files:** `frontend/src/components/AgentCard.tsx` (new),
`frontend/src/components/AgentBar.tsx` (new)
**Effort:** 40 min | **Risk:** Low

#### `AgentCard.tsx`

```tsx
import { useState } from 'react';

interface AgentSpec {
  id: string;
  name: string;
  role: string;
  model: string;
  status: string;
  is_orchestrator?: boolean;
  tools?: { type: string; spec_template?: string; index_key?: string }[];
  connected_agents?: string[];
}

export function AgentCard({ agent }: { agent: AgentSpec }) {
  const [showTooltip, setShowTooltip] = useState(false);

  const dotColor = agent.status === 'provisioned'
    ? 'bg-status-success'
    : agent.status === 'provisioning'
      ? 'bg-amber-400 animate-pulse'
      : agent.status === 'error'
        ? 'bg-status-error'
        : 'bg-text-muted';

  return (
    <div
      className="relative inline-flex items-center gap-1.5 px-2 py-1
                 rounded bg-white/5 hover:bg-white/10 transition-colors
                 cursor-default select-none"
      onMouseEnter={() => setShowTooltip(true)}
      onMouseLeave={() => setShowTooltip(false)}
    >
      <span className={`h-1.5 w-1.5 rounded-full flex-shrink-0 ${dotColor}`} />
      <span className="text-xs text-text-secondary truncate max-w-[140px]">
        {agent.is_orchestrator && (
          <span className="text-brand mr-1" title="Orchestrator">⬡</span>
        )}
        {agent.name}
      </span>

      {showTooltip && (
        <div className="absolute left-0 top-full mt-1 z-50 min-w-[220px]
                        bg-neutral-bg3 border border-white/10 rounded-lg
                        shadow-xl p-3 text-xs text-text-secondary">
          <div className="font-medium text-text-primary mb-2">{agent.name}</div>
          <div className="space-y-1">
            <Row label="Role" value={agent.role} />
            <Row label="Model" value={agent.model} />
            {agent.tools && agent.tools.length > 0 && (
              <div>
                <span className="text-text-muted">Tools:</span>
                <ul className="ml-3 mt-0.5 space-y-0.5">
                  {agent.tools.map((t, i) => (
                    <li key={i} className="text-text-secondary">
                      • {formatTool(t)}
                    </li>
                  ))}
                </ul>
              </div>
            )}
            {agent.connected_agents && agent.connected_agents.length > 0 && (
              <Row label="Delegates to" value={agent.connected_agents.join(', ')} />
            )}
          </div>
        </div>
      )}
    </div>
  );
}

function Row({ label, value }: { label: string; value: string }) {
  return (
    <div>
      <span className="text-text-muted">{label}:</span>{' '}
      <span className="text-text-primary">{value}</span>
    </div>
  );
}

function formatTool(tool: { type: string; spec_template?: string; index_key?: string }): string {
  if (tool.type === 'openapi') return `OpenAPI: ${tool.spec_template ?? 'unknown'}`;
  if (tool.type === 'azure_ai_search') return `AI Search: ${tool.index_key ?? 'unknown'}`;
  return tool.type;
}
```

> **Audit fix (A7):** Removed dead `useRef`/`hoverRef` from original draft.
> Tooltip uses `onMouseEnter`/`onMouseLeave` state — no ref needed.

#### `AgentBar.tsx`

```tsx
import { useState, useEffect } from 'react';
import { useScenarioContext } from '../context/ScenarioContext';
import { AgentCard } from './AgentCard';

interface AgentData {
  id: string;
  name: string;
  role: string;
  model: string;
  status: string;
  is_orchestrator?: boolean;
  tools?: { type: string; spec_template?: string; index_key?: string }[];
  connected_agents?: string[];
}

export function AgentBar() {
  const { provisioningStatus, activeScenario } = useScenarioContext();
  const [agents, setAgents] = useState<AgentData[]>([]);

  useEffect(() => {
    if (!activeScenario) {
      setAgents([]);
      return;
    }
    let cancelled = false;
    fetch('/api/agents')
      .then(r => r.json())
      .then(d => {
        if (!cancelled) setAgents(d.agents ?? []);
      })
      .catch(() => {});
    return () => { cancelled = true; };
  }, [activeScenario, provisioningStatus.state]);

  if (agents.length === 0) return null;

  const sorted = [...agents].sort((a, b) => {
    if (a.is_orchestrator && !b.is_orchestrator) return -1;
    if (!a.is_orchestrator && b.is_orchestrator) return 1;
    return a.name.localeCompare(b.name);
  });

  return (
    <div className="h-8 flex-shrink-0 bg-neutral-bg2 border-b border-white/10
                    flex items-center gap-2 px-6 overflow-x-auto">
      {sorted.map(agent => (
        <AgentCard key={agent.id} agent={agent} />
      ))}
    </div>
  );
}
```

#### Design decisions

- **No separate health poll** — status comes from `GET /api/agents`.
  `provisioningStatus.state` dependency triggers refetch on change.
- **Orchestrator first** — sort places entry-point agent leftmost.
- **No render when empty** — avoids blank 32px gap.
- **`overflow-x-auto`** — scrolls if many agents.

---

### Phase 3: Remove Health Indicators + Wire AgentBar into Header

**Files:** `frontend/src/components/Header.tsx`
**Effort:** 15 min | **Risk:** Low

Combines old Phases 3 + 4. Delete `HealthDot` import, inline agent state,
agent-count fetch, and derived variables. Add `AgentBar` between `<header>`
and `<ProvisioningBanner>`.

#### Resulting `Header.tsx`

```tsx
import { useState } from 'react';
import { ScenarioChip } from './ScenarioChip';
import { AgentBar } from './AgentBar';
import { ProvisioningBanner } from './ProvisioningBanner';
import { FabricSetupModal } from './FabricSetupModal';
import { useScenarioContext } from '../context/ScenarioContext';

export function Header() {
  const { activeScenarioRecord } = useScenarioContext();
  const [fabricOpen, setFabricOpen] = useState(false);

  const isFabricScenario = activeScenarioRecord?.graph_connector === 'fabric-gql';

  return (
    <>
      <header className="h-12 flex-shrink-0 bg-neutral-bg2 border-b border-white/10
                         flex items-center px-6">
        <div className="flex items-center gap-3">
          <span className="text-brand text-lg leading-none">◆</span>
          <h1 className="text-lg font-semibold text-text-primary leading-none">
            AI Incident Investigator
          </h1>
          <span className="text-xs text-text-muted ml-1 hidden sm:inline">
            Multi-agent diagnosis
          </span>
          <ScenarioChip />
          {isFabricScenario && (
            <button
              onClick={() => setFabricOpen(true)}
              className="text-xs text-cyan-400 hover:text-cyan-300 ..."
              title="Fabric Setup"
            >
              ⬡ Fabric
            </button>
          )}
        </div>
      </header>
      <AgentBar />
      <ProvisioningBanner />
      <FabricSetupModal open={fabricOpen} onClose={() => setFabricOpen(false)} />
    </>
  );
}
```

> **Audit fix (A4):** `import { useState } from 'react'` included.

#### Resulting visual stack

```
┌─ Header (h-12) ─────────────────────────────────────────────────────────┐
│  ◆ AI Incident Investigator  │ ScenarioChip │ ⬡ Fabric                  │
├─ AgentBar (h-8, conditional) ────────────────────────────────────────────┤
│  ⬡ Orchestrator   ● GraphExplorer   ● TelemetryAgent   ● RunbookKB     │
├─ ProvisioningBanner (h-7, conditional) ──────────────────────────────────┤
│  ⚡ Agents provisioned successfully                                      │
├─ TabBar ─────────────────────────────────────────────────────────────────┤
│  ❖ Investigate   ℹ Scenario Info   ◎ Resources                          │
├─ Main content ───────────────────────────────────────────────────────────┤
```

> **Note:** `HealthDot.tsx` is not deleted — may be reused in Phase 8.
> If nothing imports it after this change, remove in a future cleanup.

---

### Phase 4: Standardise Resize Handles with Grip Affordance

**Files:** `frontend/src/styles/globals.css`, `frontend/src/App.tsx`
**Effort:** 20 min | **Risk:** Low

#### New CSS in `globals.css`

```css
/* ── Resize handle base ───────────────────────────────────────────── */
.resize-handle {
  position: relative;
  flex-shrink: 0;
  transition: background-color 150ms ease;
  z-index: 10;
}

.resize-handle::after {
  content: '';
  position: absolute;
  border-radius: 2px;
  background: hsla(0, 0%, 100%, 0.12);
  transition: background-color 150ms ease, box-shadow 150ms ease;
}

.resize-handle:hover {
  background: hsla(0, 0%, 100%, 0.06);
}

.resize-handle:hover::after {
  background: hsla(0, 0%, 100%, 0.30);
  box-shadow: 0 0 6px hsla(260, 80%, 65%, 0.15);
}

.resize-handle[data-resize-handle-active]::after {
  background: hsla(260, 80%, 65%, 0.6);
  box-shadow: 0 0 8px hsla(260, 80%, 65%, 0.3);
}

/* ── Vertical (drag up/down) ──────────────────────────────────────── */
.resize-handle-vertical {
  height: 8px;
  cursor: row-resize;
}

.resize-handle-vertical::after {
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  width: 32px;
  height: 3px;
}

/* ── Horizontal (drag left/right) ─────────────────────────────────── */
.resize-handle-horizontal {
  width: 8px;
  cursor: col-resize;
}

.resize-handle-horizontal::after {
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 3px;
  height: 32px;
}
```

> **Audit fix (A3):** No `composes:` — the project uses plain CSS, not CSS
> Modules. Shared `.resize-handle` styles are applied via dual classNames in
> JSX (`className="resize-handle resize-handle-vertical"`).

#### Update handle sites in `App.tsx`

```diff
- <PanelResizeHandle className="vertical-resize-handle" />
+ <PanelResizeHandle className="resize-handle resize-handle-vertical" />

- <PanelResizeHandle className="h-1 bg-white/5 hover:bg-brand/30 transition-colors cursor-row-resize" />
+ <PanelResizeHandle className="resize-handle resize-handle-vertical" />
```

#### Remove old classes from `globals.css`

Delete `.vertical-resize-handle` and `.metrics-resize-handle` (replaced by
the unified classes above).

---

### Phase 5: Make Investigation ↔ Diagnosis Horizontally Resizable

**Files:** `frontend/src/App.tsx`, `frontend/src/components/InvestigationPanel.tsx`,
`frontend/src/components/DiagnosisPanel.tsx`
**Effort:** 25 min | **Risk:** Low

#### In `App.tsx` — Replace fixed flex with PanelGroup

```tsx
// Before:
<div className="flex-1 flex min-h-0">
  <InvestigationPanel ... />
  <DiagnosisPanel ... />
</div>

// After:
<PanelGroup
  orientation="horizontal"
  className="flex-1 min-h-0"
  id="investigation-diagnosis-split"
  autoSaveId="investigation-diagnosis"
>
  <Panel defaultSize={50} minSize={25}>
    <InvestigationPanel ... />
  </Panel>
  <PanelResizeHandle className="resize-handle resize-handle-horizontal" />
  <Panel defaultSize={50} minSize={25}>
    <DiagnosisPanel ... />
  </Panel>
</PanelGroup>
```

> **Audit fix (A8):** `autoSaveId` preserves user-adjusted sizes across tab
> switches and page reloads.

#### Remove fixed widths from panels

**`InvestigationPanel.tsx`:**
```diff
- <div className="w-full lg:w-1/2 border-r border-white/10 overflow-y-auto p-4 flex flex-col">
+ <div className="h-full overflow-y-auto p-4 flex flex-col">
```

**`DiagnosisPanel.tsx`:**
```diff
- <div className="w-full lg:w-1/2 overflow-y-auto p-4 flex flex-col">
+ <div className="h-full overflow-y-auto p-4 flex flex-col">
```

Both panels now fill whatever size `react-resizable-panels` assigns.
`border-r` removed — the resize handle provides the visual separator.

---

### Phase 6: Make History Sidebar Horizontally Resizable

**Files:** `frontend/src/App.tsx`, `frontend/src/components/InteractionSidebar.tsx`
**Effort:** 35 min | **Risk:** Low–Medium

#### In `App.tsx` — Wrap content + sidebar in PanelGroup

```tsx
// Before:
<>
  <div className="flex-1 min-w-0">
    <PanelGroup orientation="vertical" ...>
      {/* topology + investigation/diagnosis */}
    </PanelGroup>
  </div>
  <InteractionSidebar ... />
</>

// After:
const sidebarRef = useRef<ImperativePanelHandle>(null);

<PanelGroup
  orientation="horizontal"
  className="h-full"
  id="main-sidebar-split"
  autoSaveId="main-sidebar"
>
  <Panel defaultSize={80} minSize={50}>
    <PanelGroup orientation="vertical" autoSaveId="topology-split" ...>
      {/* topology + investigation/diagnosis */}
    </PanelGroup>
  </Panel>
  <PanelResizeHandle className="resize-handle resize-handle-horizontal" />
  <Panel
    ref={sidebarRef}
    defaultSize={20}
    minSize={3}
    maxSize={35}
    collapsible
    onResize={(size) => setSidebarCollapsed(size === 0)}
  >
    <InteractionSidebar
      collapsed={sidebarCollapsed}
      onToggleCollapse={() => {
        const panel = sidebarRef.current;
        if (!panel) return;
        panel.isCollapsed() ? panel.expand() : panel.collapse();
      }}
      ...
    />
  </Panel>
</PanelGroup>
```

> **Audit fix (A5, A6):** `onCollapse`/`onExpand` don't exist in
> react-resizable-panels@4.6.2. Using `onResize` to detect collapsed state
> and `panelRef` imperative API (`.collapse()`, `.expand()`,
> `.isCollapsed()`) for two-way sync between the toggle button and drag.

New import at the top of `App.tsx`:

```tsx
import { useRef } from 'react';
import type { ImperativePanelHandle } from 'react-resizable-panels';
```

#### Simplify `InteractionSidebar.tsx` sizing

```diff
- <div className={`
-   border-l border-white/10 bg-neutral-bg2 flex flex-col
-   transition-[width] duration-200 ease-out
-   ${collapsed ? 'w-10' : 'w-72'}
- `}>
+ <div className="h-full border-l border-white/10 bg-neutral-bg2 flex flex-col">
```

The `collapsed` prop is retained for content visibility (hide interaction
list, collapse header text), but **width is now panel-controlled**.

---

### Phase 7 (Optional): `autoSaveId` on Existing PanelGroups

**Files:** `frontend/src/App.tsx`
**Effort:** 2 min | **Risk:** None

Add `autoSaveId` to the two pre-existing PanelGroups that don't have it yet
(if not already done in Phases 5/6):

```tsx
// Content ↕ Terminal split
<PanelGroup orientation="vertical" autoSaveId="content-terminal" ...>

// Topology ↕ Investigation split
<PanelGroup orientation="vertical" autoSaveId="topology-split" ...>
```

This prevents user-adjusted panel sizes from resetting on tab switches.

---

### Phase 8 (Optional): Fold API Health into AgentBar

**Files:** `frontend/src/components/AgentBar.tsx`
**Effort:** 5 min | **Risk:** None

If the API health dot is missed after Phase 3, add it at the left edge of
the AgentBar before the agent cards:

```tsx
<HealthDot label="API" />
<div className="w-px h-4 bg-white/10" />
{sorted.map(agent => <AgentCard key={agent.id} agent={agent} />)}
```

**Decision:** Defer to user preference after Phase 3 deploy.

---

## Files Modified (Summary)

| File | Phase | Changes |
|------|-------|---------|
| `api/app/agent_ids.py` | 1 | Fix nested iteration; add `_make_agent_stub` with spec fields |
| `scripts/agent_provisioner.py` | 1 | Persist `model`, `tools`, `is_orchestrator`, `connected_agents` in both write paths |
| `frontend/src/components/AgentCard.tsx` | 2 | **NEW** — agent chip with hover tooltip |
| `frontend/src/components/AgentBar.tsx` | 2 | **NEW** — horizontal strip of AgentCards |
| `frontend/src/components/Header.tsx` | 3 | Remove health dots + dead state; add `AgentBar` + `useState` import |
| `frontend/src/styles/globals.css` | 4 | Add `.resize-handle` base + vertical/horizontal variants; remove old classes |
| `frontend/src/App.tsx` | 4, 5, 6, 7 | Swap handle classes; wrap Investigation/Diagnosis + sidebar in PanelGroup; add `autoSaveId`; add `sidebarRef` + `ImperativePanelHandle` |
| `frontend/src/components/InvestigationPanel.tsx` | 5 | Remove fixed `w-1/2`, fill parent panel |
| `frontend/src/components/DiagnosisPanel.tsx` | 5 | Remove fixed `w-1/2`, fill parent panel |
| `frontend/src/components/InteractionSidebar.tsx` | 6 | Remove fixed `w-72`/`w-10`; keep `collapsed` for content visibility only |

---

## Success Criteria

**Agent Bar (Phases 1–3):**
- [ ] Agent bar visible beneath header when agents are provisioned
- [ ] Each agent shown as a card with health dot + name
- [ ] Orchestrator visually distinguished (⬡ icon + sorted first)
- [ ] Hover tooltip shows: role, model, tools, connected agents
- [ ] No agents → no agent bar rendered (no empty strip)
- [ ] API and Agent health dots removed from header top-right
- [ ] Agent bar updates after provisioning completes (no page reload)
- [ ] Works with all scenarios (telco-noc: 5 agents, telco-backbone: 4 agents)

**Resizable Panels (Phases 4–7):**
- [ ] All resize handles show a visible grip indicator (pill)
- [ ] Grip brightens on hover, turns brand colour on active drag
- [ ] Investigation ↔ Diagnosis boundary is draggable left/right
- [ ] History sidebar boundary is draggable left/right
- [ ] Topology ↕ Investigation boundary retains existing drag behaviour
- [ ] Content ↕ Terminal boundary retains existing drag behaviour
- [ ] Sidebar still collapses via toggle button (and via drag-to-minimum)
- [ ] All panels respect `minSize` — no panel can be dragged to zero
- [ ] Panel sizes persist across tab switches (`autoSaveId`)

---

## Audit Trail

All audit findings have been incorporated into the phases above. Reference
table for traceability:

| # | Severity | Phase | Finding | Resolution |
|---|----------|-------|---------|------------|
| A1 | CRITICAL | 1 | `get_agent_list()` skips sub-agents (nested JSON) | Phase 1a: nested iteration logic |
| A2 | CRITICAL | 1 | No spec fields in `agent_ids.json` | Phase 1b: enrich both provisioner paths |
| A3 | BUG | 4 | `composes` ignored in plain CSS | Phase 4: removed, dual classNames sufficient |
| A4 | BUG | 3 | Missing `useState` import in Header | Phase 3: included in imports |
| A5 | BUG | 6 | `onCollapse`/`onExpand` don't exist on Panel | Phase 6: `onResize` + `panelRef` |
| A6 | BUG | 6 | No toggle ↔ drag two-way sync | Phase 6: imperative API wiring shown |
| A7 | Minor | 2 | Dead `hoverRef` / `useRef` in AgentCard | Phase 2: removed from code |
| A8 | Note | 5, 6, 7 | Tab switch resets panel sizes | Phases 5–7: `autoSaveId` on all PanelGroups |
| A9 | OK | All | 5 items validated safe | No change needed |
