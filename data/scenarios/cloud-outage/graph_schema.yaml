# ============================================================================
# Graph Schema Manifest — Cloud Datacenter Topology
# ============================================================================
# Declarative definition of vertices and edges for the cloud-outage scenario.
# Used by scripts/cosmos/provision_cosmos_gremlin.py to load data from CSVs.
# ============================================================================

# Directory containing CSV files (relative to this schema file's directory)
data_dir: data/entities

# ---------------------------------------------------------------------------
# Vertices — 8 entity types
# ---------------------------------------------------------------------------

vertices:
  - label: Region
    csv_file: DimRegion.csv
    id_column: RegionId
    partition_key: region
    properties: [RegionId, RegionName, Country, Provider]

  - label: AvailabilityZone
    csv_file: DimAvailabilityZone.csv
    id_column: AZId
    partition_key: az
    properties: [AZId, AZName, RegionId, CoolingSystem, PowerFeedCount]

  - label: Rack
    csv_file: DimRack.csv
    id_column: RackId
    partition_key: rack
    properties: [RackId, RackPosition, AZId, MaxPowerKW, CoolingZone]

  - label: Host
    csv_file: DimHost.csv
    id_column: HostId
    partition_key: host
    properties: [HostId, Hostname, RackId, CPUCores, MemoryGB, Vendor]

  - label: VirtualMachine
    csv_file: DimVirtualMachine.csv
    id_column: VMId
    partition_key: vm
    properties: [VMId, VMName, HostId, ServiceId, vCPUs, MemoryGB, OSType]

  - label: LoadBalancer
    csv_file: DimLoadBalancer.csv
    id_column: LBId
    partition_key: lb
    properties: [LBId, LBName, LBType, RegionId, Algorithm, HealthCheckPath]

  - label: Service
    csv_file: DimService.csv
    id_column: ServiceId
    partition_key: service
    properties: [ServiceId, ServiceName, ServiceType, Tier, Owner]

  - label: SLAPolicy
    csv_file: DimSLAPolicy.csv
    id_column: SLAId
    partition_key: sla
    properties: [SLAId, SLAName, ServiceId, UptimePct, MaxLatencyMs, RPOMinutes]

# ---------------------------------------------------------------------------
# Edges — 14 edge definitions
# ---------------------------------------------------------------------------

edges:
  # Region → has_zone → AvailabilityZone
  - label: has_zone
    csv_file: DimAvailabilityZone.csv
    source:
      label: Region
      property: RegionId
      column: RegionId
    target:
      label: AvailabilityZone
      property: AZId
      column: AZId

  # AvailabilityZone → has_rack → Rack
  - label: has_rack
    csv_file: DimRack.csv
    source:
      label: AvailabilityZone
      property: AZId
      column: AZId
    target:
      label: Rack
      property: RackId
      column: RackId

  # Rack → hosts_server → Host
  - label: hosts_server
    csv_file: DimHost.csv
    source:
      label: Rack
      property: RackId
      column: RackId
    target:
      label: Host
      property: HostId
      column: HostId

  # Host → runs → VirtualMachine
  - label: runs
    csv_file: DimVirtualMachine.csv
    source:
      label: Host
      property: HostId
      column: HostId
    target:
      label: VirtualMachine
      property: VMId
      column: VMId

  # VirtualMachine → serves → Service
  - label: serves
    csv_file: DimVirtualMachine.csv
    source:
      label: VirtualMachine
      property: VMId
      column: VMId
    target:
      label: Service
      property: ServiceId
      column: ServiceId

  # LoadBalancer → lb_in_region → Region
  - label: lb_in_region
    csv_file: DimLoadBalancer.csv
    source:
      label: LoadBalancer
      property: LBId
      column: LBId
    target:
      label: Region
      property: RegionId
      column: RegionId

  # SLAPolicy → governs → Service
  - label: governs
    csv_file: DimSLAPolicy.csv
    source:
      label: SLAPolicy
      property: SLAId
      column: SLAId
    target:
      label: Service
      property: ServiceId
      column: ServiceId

  # Service depends_on Service
  - label: depends_on
    csv_file: FactServiceDependency.csv
    filter:
      column: DependsOnType
      value: Service
    source:
      label: Service
      property: ServiceId
      column: ServiceId
    target:
      label: Service
      property: ServiceId
      column: DependsOnId
    properties:
      - name: strength
        column: DependencyStrength

  # Service depends_on LoadBalancer
  - label: depends_on
    csv_file: FactServiceDependency.csv
    filter:
      column: DependsOnType
      value: LoadBalancer
    source:
      label: Service
      property: ServiceId
      column: ServiceId
    target:
      label: LoadBalancer
      property: LBId
      column: DependsOnId
    properties:
      - name: strength
        column: DependencyStrength
