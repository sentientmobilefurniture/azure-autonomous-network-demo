# ============================================================================
# Scenario Manifest — Cloud Datacenter Outage (Cooling Cascade)
# ============================================================================

name: cloud-outage
display_name: "Cloud Datacenter Outage — Cooling Cascade"
description: >
  A CRAC unit failure in US-East Availability Zone A triggers cascading
  thermal shutdowns across 5 hosts. VMs become unreachable, services degrade,
  and load balancers fail over to AZ-B. The AI investigates root cause,
  blast radius, and failover effectiveness.
version: "1.0"
domain: cloud-infrastructure

# ---------------------------------------------------------------------------
# Data layout — paths relative to this file's parent directory
# ---------------------------------------------------------------------------

paths:
  entities: data/entities
  graph_schema: graph_schema.yaml
  telemetry: data/telemetry
  runbooks: data/knowledge/runbooks
  tickets: data/knowledge/tickets
  prompts: data/prompts
  default_alert: data/prompts/default_alert.md

# ---------------------------------------------------------------------------
# Cosmos DB mapping
# ---------------------------------------------------------------------------

cosmos:
  gremlin:
    database: networkgraph
    graph: topology
  nosql:
    database: telemetry
    containers:
      - name: AlertStream
        partition_key: /SourceNodeType
        csv_file: AlertStream.csv
        id_field: AlertId
        numeric_fields: [TemperatureCelsius, CPUUtilPct, MemoryUtilPct, DiskIOPS]
      - name: HostMetrics
        partition_key: /HostId
        csv_file: HostMetrics.csv
        id_field: MetricId
        numeric_fields: [CPUUtilPct, MemoryUtilPct, TemperatureCelsius, DiskIOPS]

# ---------------------------------------------------------------------------
# AI Search indexes
# ---------------------------------------------------------------------------

search_indexes:
  - name: runbooks-index
    container: runbooks
    source: data/knowledge/runbooks
  - name: tickets-index
    container: tickets
    source: data/knowledge/tickets

# ---------------------------------------------------------------------------
# Graph visualisation hints
# ---------------------------------------------------------------------------

graph_styles:
  node_types:
    Region:           { color: "#ef4444", size: 30, icon: "globe" }
    AvailabilityZone: { color: "#f97316", size: 26, icon: "zone" }
    Rack:             { color: "#eab308", size: 18, icon: "rack" }
    Host:             { color: "#3b82f6", size: 20, icon: "server" }
    VirtualMachine:   { color: "#8b5cf6", size: 14, icon: "vm" }
    LoadBalancer:     { color: "#06b6d4", size: 22, icon: "loadbalancer" }
    Service:          { color: "#22c55e", size: 20, icon: "service" }
    SLAPolicy:        { color: "#94a3b8", size: 12, icon: "policy" }

# ---------------------------------------------------------------------------
# Telemetry baselines
# ---------------------------------------------------------------------------

telemetry_baselines:
  host_metrics:
    - metric: TemperatureCelsius
      normal: "22–28°C"
      degraded: "> 35°C"
      down: "> 85°C (thermal shutdown)"
    - metric: CPUUtilPct
      normal: "15–45%"
      degraded: "> 80%"
      down: "0% (host shutdown)"
    - metric: MemoryUtilPct
      normal: "30–60%"
      degraded: "> 85%"
      down: "0% (host shutdown)"
    - metric: DiskIOPS
      normal: "200–800"
      degraded: "> 2000"
      down: "0 (host shutdown)"
  alert_stream:
    - metric: TemperatureCelsius
      normal: "22–28°C"
      anomalous: "> 35°C"
    - metric: CPUUtilPct
      normal: "< 50%"
      anomalous: "> 85%"
    - metric: MemoryUtilPct
      normal: "< 65%"
      anomalous: "> 85%"
    - metric: DiskIOPS
      normal: "200–800"
      anomalous: "> 2000 or 0"
