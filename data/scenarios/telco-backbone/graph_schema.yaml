# ============================================================================
# Graph Schema Manifest â€” Telco Backbone Topology
# ============================================================================
# Declarative definition of vertices and edges for the Cosmos DB Gremlin graph.
# Used by scripts/cosmos/provision_cosmos_gremlin.py to load data from CSVs.
#
# 10 vertex types, 14 edge types.
# ============================================================================

data_dir: data/entities

# ---------------------------------------------------------------------------
# Vertices
# ---------------------------------------------------------------------------

vertices:
  - label: DataCenter
    csv_file: DimDataCenter.csv
    id_column: DataCenterId
    partition_key: datacenter
    properties: [DataCenterId, City, Region, Tier, PowerRedundancy]

  - label: CoreRouter
    csv_file: DimCoreRouter.csv
    id_column: RouterId
    partition_key: router
    properties: [RouterId, City, Region, Vendor, Model, DataCenterId]

  - label: TransportLink
    csv_file: DimTransportLink.csv
    id_column: LinkId
    partition_key: link
    properties: [LinkId, LinkType, CapacityGbps, SourceRouterId, TargetRouterId]

  - label: FirewallCluster
    csv_file: DimFirewallCluster.csv
    id_column: FirewallId
    partition_key: firewall
    properties: [FirewallId, City, Vendor, Model, DataCenterId]

  - label: AggSwitch
    csv_file: DimAggSwitch.csv
    id_column: SwitchId
    partition_key: switch
    properties: [SwitchId, City, UplinkRouterId]

  - label: BaseStation
    csv_file: DimBaseStation.csv
    id_column: StationId
    partition_key: basestation
    properties: [StationId, StationType, AggSwitchId, City]

  - label: BGPSession
    csv_file: DimBGPSession.csv
    id_column: SessionId
    partition_key: session
    properties: [SessionId, PeerARouterId, PeerBRouterId, ASNumberA, ASNumberB]

  - label: MPLSPath
    csv_file: DimMPLSPath.csv
    id_column: PathId
    partition_key: path
    properties: [PathId, PathType]

  - label: Service
    csv_file: DimService.csv
    id_column: ServiceId
    partition_key: service
    properties: [ServiceId, ServiceType, CustomerName, CustomerCount, ActiveUsers]

  - label: SLAPolicy
    csv_file: DimSLAPolicy.csv
    id_column: SLAPolicyId
    partition_key: policy
    properties: [SLAPolicyId, ServiceId, AvailabilityPct, MaxLatencyMs, PenaltyPerHourUSD, Tier]

# ---------------------------------------------------------------------------
# Edges
# ---------------------------------------------------------------------------

edges:
  # CoreRouter housed_in DataCenter
  - label: housed_in
    csv_file: DimCoreRouter.csv
    source:
      label: CoreRouter
      property: RouterId
      column: RouterId
    target:
      label: DataCenter
      property: DataCenterId
      column: DataCenterId

  # FirewallCluster located_at DataCenter
  - label: located_at
    csv_file: DimFirewallCluster.csv
    source:
      label: FirewallCluster
      property: FirewallId
      column: FirewallId
    target:
      label: DataCenter
      property: DataCenterId
      column: DataCenterId

  # TransportLink connects_to CoreRouter (source side)
  - label: connects_to
    csv_file: DimTransportLink.csv
    source:
      label: TransportLink
      property: LinkId
      column: LinkId
    target:
      label: CoreRouter
      property: RouterId
      column: SourceRouterId
    properties:
      - name: direction
        value: source

  # TransportLink connects_to CoreRouter (target side)
  - label: connects_to
    csv_file: DimTransportLink.csv
    source:
      label: TransportLink
      property: LinkId
      column: LinkId
    target:
      label: CoreRouter
      property: RouterId
      column: TargetRouterId
    properties:
      - name: direction
        value: target

  # AggSwitch aggregates_to CoreRouter
  - label: aggregates_to
    csv_file: DimAggSwitch.csv
    source:
      label: AggSwitch
      property: SwitchId
      column: SwitchId
    target:
      label: CoreRouter
      property: RouterId
      column: UplinkRouterId

  # BaseStation backhauls_via AggSwitch
  - label: backhauls_via
    csv_file: DimBaseStation.csv
    source:
      label: BaseStation
      property: StationId
      column: StationId
    target:
      label: AggSwitch
      property: SwitchId
      column: AggSwitchId

  # MPLSPath routes_via TransportLink (only TransportLink hops)
  - label: routes_via
    csv_file: FactMPLSPathHops.csv
    filter:
      column: NodeType
      value: TransportLink
    source:
      label: MPLSPath
      property: PathId
      column: PathId
    target:
      label: TransportLink
      property: LinkId
      column: NodeId
    properties:
      - name: HopOrder
        column: HopOrder

  # MPLSPath traverses CoreRouter (only CoreRouter hops)
  - label: traverses
    csv_file: FactMPLSPathHops.csv
    filter:
      column: NodeType
      value: CoreRouter
    source:
      label: MPLSPath
      property: PathId
      column: PathId
    target:
      label: CoreRouter
      property: RouterId
      column: NodeId
    properties:
      - name: HopOrder
        column: HopOrder

  # Service depends_on MPLSPath
  - label: depends_on
    csv_file: FactServiceDependency.csv
    filter:
      column: DependsOnType
      value: MPLSPath
    source:
      label: Service
      property: ServiceId
      column: ServiceId
    target:
      label: MPLSPath
      property: PathId
      column: DependsOnId
    properties:
      - name: DependencyStrength
        column: DependencyStrength

  # Service depends_on AggSwitch
  - label: depends_on
    csv_file: FactServiceDependency.csv
    filter:
      column: DependsOnType
      value: AggSwitch
    source:
      label: Service
      property: ServiceId
      column: ServiceId
    target:
      label: AggSwitch
      property: SwitchId
      column: DependsOnId
    properties:
      - name: DependencyStrength
        column: DependencyStrength

  # Service depends_on BaseStation
  - label: depends_on
    csv_file: FactServiceDependency.csv
    filter:
      column: DependsOnType
      value: BaseStation
    source:
      label: Service
      property: ServiceId
      column: ServiceId
    target:
      label: BaseStation
      property: StationId
      column: DependsOnId
    properties:
      - name: DependencyStrength
        column: DependencyStrength

  # FirewallCluster protects Service
  - label: protects
    csv_file: FactFirewallProtects.csv
    source:
      label: FirewallCluster
      property: FirewallId
      column: FirewallId
    target:
      label: Service
      property: ServiceId
      column: ServiceId
    properties:
      - name: PolicyType
        column: PolicyType

  # SLAPolicy governed_by Service
  - label: governed_by
    csv_file: DimSLAPolicy.csv
    source:
      label: SLAPolicy
      property: SLAPolicyId
      column: SLAPolicyId
    target:
      label: Service
      property: ServiceId
      column: ServiceId

  # BGPSession peers_over CoreRouter (Peer A)
  - label: peers_over
    csv_file: DimBGPSession.csv
    source:
      label: BGPSession
      property: SessionId
      column: SessionId
    target:
      label: CoreRouter
      property: RouterId
      column: PeerARouterId
    properties:
      - name: ASNumber
        column: ASNumberA

  # BGPSession peers_over CoreRouter (Peer B)
  - label: peers_over
    csv_file: DimBGPSession.csv
    source:
      label: BGPSession
      property: SessionId
      column: SessionId
    target:
      label: CoreRouter
      property: RouterId
      column: PeerBRouterId
    properties:
      - name: ASNumber
        column: ASNumberB
